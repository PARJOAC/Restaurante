<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Comandas</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">
    <h1>Gestión de Comandas</h1>

    <!-- Formulario de inicio de sesión -->
    <div class="login-container" id="login-container">
      <input id="username" type="text" placeholder="Usuario" required>
      <input id="password" type="password" placeholder="Contraseña" required>
      <button class="button" id="login-btn">Iniciar sesión</button>
    </div>

    <!-- Formulario para añadir nueva comanda -->
    <div class="form-container" id="form-container" style="display:none;">
      <input id="comanda-id" type="number" placeholder="ID de comanda">
      <input id="plato-nombre" type="text" placeholder="Nombre del plato">
      <input id="plato-cantidad" type="number" placeholder="Cantidad" min="1">
      <input id="plato-precio" type="number" placeholder="Precio" step="0.01">
      <button class="button" id="agregar-comanda">Añadir Comanda</button>
    </div>

    <!-- Lista de las comandas -->
    <div id="comanda-list" class="comanda-list"></div>

    <button class="button" id="eliminar-todas">Eliminar Todas las Comandas</button>
  </div>

  <script>
    let isLoggedIn = false;

    // Función para verificar si el usuario está logueado
    function checkLogin() {
      if (isLoggedIn) {
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('form-container').style.display = 'flex';
        cargarComandas(); // Cargar las comandas al iniciar sesión
      } else {
        alert('Por favor, inicia sesión');
      }
    }

    // Función para cargar las comandas desde el servidor
    async function cargarComandas() {
      const response = await fetch('/api/comandas');
      const comandas = await response.json();
      const comandaList = document.getElementById('comanda-list');
      comandaList.innerHTML = ''; // Limpiar la lista antes de actualizar

      comandas.forEach(comanda => {
        const comandaElement = document.createElement('div');
        comandaElement.classList.add('comanda');
        comandaElement.innerHTML = `
          <h2>Comanda #${comanda.id}</h2>
          <div>
            ${comanda.platos.map(plato => `
              <p>${plato.nombre} - Cantidad: ${plato.cantidad} - Precio: €${plato.precio}</p>
            `).join('')}
          </div>
          <p>Total: €<span>${comanda.total}</span></p>
          <button class="button" onclick="eliminarComanda('${comanda._id}')">Eliminar Comanda</button>
        `;
        comandaList.appendChild(comandaElement);
      });
    }

    // Función para añadir una nueva comanda
    document.getElementById('agregar-comanda').addEventListener('click', async () => {
      const id = document.getElementById('comanda-id').value;
      const nombre = document.getElementById('plato-nombre').value;
      const cantidad = document.getElementById('plato-cantidad').value;
      const precio = document.getElementById('plato-precio').value;

      if (!id || !nombre || !cantidad || !precio) {
        alert('Por favor complete todos los campos');
        return;
      }

      const comanda = {
        id: parseInt(id),
        platos: [{
          nombre: nombre,
          cantidad: parseInt(cantidad),
          precio: parseFloat(precio)
        }],
        total: parseInt(cantidad) * parseFloat(precio)
      };

      await fetch('/api/comandas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(comanda)
      });

      cargarComandas(); // Recargar las comandas
    });

    // Función para eliminar una comanda
    async function eliminarComanda(id).addEventListener('click', async () => {
      await fetch(`/api/comandas/${id}`, { method: 'DELETE' });
      cargarComandas(); // Recargar las comandas después de eliminar
    }

    // Función para eliminar todas las comandas
    document.getElementById('eliminar-todas').addEventListener('click', async () => {
      await fetch('/api/comandas', { method: 'DELETE' });
      cargarComandas(); // Recargar las comandas después de eliminar todas
    });

    // Función de inicio de sesión
    document.getElementById('login-btn').addEventListener('click', () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      // Verifica usuario y contraseña (esto puede cambiar según el servidor)
      if (username === 'admin' && password === '1234') {
        isLoggedIn = true;
        checkLogin(); // Al iniciar sesión, se carga la interfaz de la aplicación
      } else {
        alert('Credenciales incorrectas');
      }
    });
  </script>
</body>
</html>